<!DOCTYPE html>
<html>
<head>
    <title>Customer List</title>
</head>
<body>
<h2>Customer List</h2>
<button onclick="fetchCustomers()">Fetch Customers</button>
<button onclick="syncCustomers()">Sync Customers</button>
<table border="1">
    <thead>
    <tr>
        <th>ID</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Street</th>
        <th>Address</th>
        <th>City</th>
        <th>State</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody id="customerTableBody">
    </tbody>
</table>
<script>
    function fetchCustomers() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/api/customers", true);
        xhr.setRequestHeader("Authorization", "Bearer " + localStorage.getItem("token"));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var customers = JSON.parse(xhr.responseText);
                var tableBody = document.getElementById('customerTableBody');
                tableBody.innerHTML = "";
                customers.content.forEach(function (customer) {
                    var row = `<tr>
                        <td>${customer.id}</td>
                        <td>${customer.firstName}</td>
                        <td>${customer.lastName}</td>
                        <td>${customer.street}</td>
                        <td>${customer.address}</td>
                        <td>${customer.city}</td>
                        <td>${customer.state}</td>
                        <td>${customer.email}</td>
                        <td>${customer.phone}</td>
                        <td>
                            <button onclick="editCustomer(${customer.id})">Edit</button>
                            <button onclick="deleteCustomer(${customer.id})">Delete</button>
                        </td>
                    </tr>`;
                    tableBody.insertAdjacentHTML('beforeend', row);
                });
            }
        };
        xhr.send();
    }

    function syncCustomers() {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "https://qa.sunbasedata.com/sunbase/portal/api/assignment.jsp?cmd=get_customer_list", true);
        xhr.setRequestHeader("Authorization", "Bearer " + localStorage.getItem("token"));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                var remoteCustomers = JSON.parse(xhr.responseText);
                remoteCustomers.forEach(function (customer) {
                    saveCustomer(customer);
                });
            }
        };
        xhr.send();
    }

    function saveCustomer(customer) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/api/customers", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        xhr.setRequestHeader("Authorization", "Bearer " + localStorage.getItem("token"));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                fetchCustomers();
            }
        };
        xhr.send(JSON.stringify(customer));
    }

    function editCustomer(id) {
        // Code to edit a customer
    }

    function deleteCustomer(id) {
        var xhr = new XMLHttpRequest();
        xhr.open("DELETE", "/api/customers/" + id, true);
        xhr.setRequestHeader("Authorization", "Bearer " + localStorage.getItem("token"));
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                fetchCustomers();
            }
        };
        xhr.send();
    }

    window.onload = function() {
        fetchCustomers();
    };
</script>
</body>
</html>
